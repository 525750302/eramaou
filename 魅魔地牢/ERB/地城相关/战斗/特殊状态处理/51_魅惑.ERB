;-------------------------------------------------
;特殊状态相关的处理函数
;包括增加状态数值的 ADD_ENEMY_STATE_XXX 与 ADD_SUCCUBUS_STATE_XXX
;减少状态数值的 DECREASE_ENEMY_STATE_XXX 与 DECREASE_SUCCUBUS_STATE_XXX
;返还状态数值的 CHECK_ENEMY_STATE_XXX 与 CHECK_SUCCUBUS_STATE_XXX
;注意事项：有些状态不能过被减少，有些状态只有勇者拥有。大部分状态效果的发动和结算在减少状态的函数中，但是对于遅い等会影响属性的状态在增加函数中也有可能会发动
;魅了为勇者独有的属性
;-------------------------------------------------
;返还勇者的状态数值
@CHECK_ENEMY_STATE_51, ARG
SIF ARG <= 0
    RETURN 0
SIF ENEMY_STATE:ARG:51 <= ENEMY_STATE:ARG:151
    RETURN 0
LOCAL = ENEMY_STATE:ARG:51
RETURN 1

;--------------------------------
;增加状态数值
;ARG为勇者的编号 ARG:1为增加的数值
@ADD_ENEMY_STATE_51, ARG , ARG:1
SIF ARG <= 0
    RETURN 0

ENEMY_STATE:ARG:51 = ENEMY_STATE:ARG:51 + ARG:1


;--------------------------------
;减少状态数值
;大部分状态的效果处理在这里完成
;不同状态减少的方式不同
@DECREASE_ENEMY_STATE_51, ARG, ARG:1
#DIM ROOM_ENEMY_NUM
#DIM ENEMY_X
#DIM ENEMY_Y
#DIM COUNT1
#DIMS ENEMY_NAME
#DIM ENEMY_RACE
#DIMS TARGET_NAME

CALL RESET_TEXT_RETURN
ENEMY_RACE = ENEMY:(ARG)
TRYCALLFORM ENEMY_NAME_{ENEMY_RACE}
IF TEXT_RETURN:0 !=""
    ENEMY_NAME = %TEXT_RETURN:0%
ENDIF

ENEMY_X = ENEMY_LOCATION_X:ARG
ENEMY_Y = ENEMY_LOCATION_Y:ARG
SIF ARG <= 0
    RETURN

ROOM_ENEMY_NUM = ENEMY_DUNGEON_LOCATION:ENEMY_X:ENEMY_Y:0 + 1
;如果房间中只有一个勇者那么不会触发状态
IF ROOM_ENEMY_NUM <= 2
    RETURN -1
ENDIF
$RAND_LOOP
COUNT1 = RAND(ROOM_ENEMY_NUM)
IF ENEMY:(ENEMY_DUNGEON_LOCATION:ENEMY_X:ENEMY_Y:COUNT1) <= 0 || ENEMY:(ENEMY_DUNGEON_LOCATION:ENEMY_X:ENEMY_Y:COUNT1) == ARG
    GOTO RAND_LOOP
ENDIF   
TRYCALLFORM ENEMY_NAME_{ENEMY:(ENEMY_DUNGEON_LOCATION:ENEMY_X:ENEMY_Y:COUNT1)}
IF TEXT_RETURN:0 !=""
    TARGET_NAME = %TEXT_RETURN:0%
ENDIF
LOCALS = %ENEMY_NAME%が魅了され、%TARGET_NAME%を攻撃した
CALL ADD_BATTLE_LOG, LOCALS

ENEMY_STATE:ARG:51 = MAX(0,ENEMY_STATE:ARG:51 - ENEMY_STATE:ARG:151)
;增加魅了耐性
ENEMY_STATE:ARG:151 = ENEMY_STATE:ARG:151 + 1

RETURN ENEMY_DUNGEON_LOCATION:ENEMY_X:ENEMY_Y:COUNT1